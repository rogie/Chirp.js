var Chirp=function(opts){function render(tpl,data){function dotData(d,dotKey){var invert="",val;dotKey.indexOf("!")>-1&&(dotKey=dotKey.replace(/!/ig,""),invert="!");try{val=eval(invert+"d['"+dotKey.split(".").join("']['")+"']")}catch(e){val=""}return val}var output=tpl,matches,i;matches=tpl.match(/\{\{[^\}\}]*\}\}/igm);for(i=0;i<matches.length;++i){var m=matches[i],val;val=dotData(data,matches[i].replace(/\{\{|\}\}/ig,""))||"",output=output.replace(new RegExp(m,"igm"),val)}return output}function ext(e,t){var n;for(n in t)e.hasOwnProperty(n)&&(e[n]&&e[n].constructor===Object?ext(e[n],t[n]):e[n]=t[n])}function ago(e){var t,n,r;t=new Date((e||"").replace(/(\d{1,2}[:]\d{2}[:]\d{2}) (.*)/,"$2 $1").replace(/(\+\S+) (.*)/,"$2 $1").replace(/-/g,"/")),n=((new Date).getTime()-t.getTime())/1e3,r=Math.floor(n/86400);if(isNaN(r)||r<0||r>=31)return;return r===0&&(n<60&&render(options.templates.justNow)||n<120&&render(options.templates.oneMinuteAgo)||n<3600&&render(options.templates.minutesAgo,{time:Math.floor(n/60)})||n<7200&&render(options.templates.oneHourAgo)||n<86400&&render(options.templates.hoursAgo,{time:Math.floor(n/3600)}))||r===1&&render(options.templates.yesterday)||r<7&&render(options.templates.daysAgo,{time:r})||r<31&&render(options.templates.weeksAgo,{time:Math.ceil(r/7)})}function htmlify(e,t){var n=[],r,i,s,o,u;o=e,u={urls:function(e){return'<a href="'+e.expanded_url+'">'+e.display_url+"</a>"},hashtags:function(e){return'<a href="http://twitter.com/search/%23'+e.text+'">#'+e.text+"</a>"},user_mentions:function(e){return'<a href="http://twitter.com/'+e.screen_name+'" title="'+e.name+'">@'+e.screen_name+"</a>"},media:function(e){return'<a href="'+e.expanded_url+'">'+e.display_url+"</a>"}};if(t)for(r in t){s=t[r];if(t[r].length>0)for(i=0,s;s=t[r][i];++i)n[s.indices[0]]={start:s.indices[0],end:s.indices[1],link:u[r](s)}}for(i=n.length-1;i>=0;--i)n[i]!==undefined&&(o=o.substr(0,n[i].start)+n[i].link+o.substr(n[i].end,o.length-1));return o}function toHTML(e){var t="",n,r;n=0;for(r in e){e[r].index=++n,e[r].html=htmlify(e[r].text,e[r].entities),e[r].time_ago=ago(e[r].created_at),t+=render(options.templates.tweet,e[r]);if(n===options.max)break}return render(options.templates.base,{tweets:t})}function cache(e,t){var n;if(!n||!JSON)return null;var r,i;r=(new Date).getTime(),i=null;if(t===undefined){try{var s;i=JSON.parse(s(n.getItem(e)))}catch(o){}return i?r-i.time<options.cacheExpire?i=i.data:(n.removeItem(e),i=null):i=null,i}try{var u;n.setItem(e,u(JSON.stringify({time:r,data:t})))}catch(o){var a;a.log(o)}}function load(){var e,t,n,r,i,s,o;Chirp.requests=Chirp.requests===undefined?1:Chirp.requests+1,e=document.createElement("script"),t="callback"+Chirp.requests,r=document.body.children,n=document.scripts[document.scripts.length-1],i=options.list?render(api.list,options):options.search?render(api.search,options):render(api.user,options),s=n.parentNode.nodeName!=="head",Chirp[t]=function(e,t){e=e.results||e,t!==!0&&cache(i,e);var r=document.createElement("div");r.innerHTML=toHTML(e),options.target===null?n.parentNode.insertBefore(r,n):document.getElementById(options.target).innerHTML=r.innerHTML,options.success.call(this,e)},e.onerror=options.error,o=cache(i),o?Chirp[t](o,!0):(e.src=i+"&callback=Chirp."+t,document.getElementsByTagName("head")[0].appendChild(e))}function init(e){if(e&&e!==undefined)if(e.constructor===String){var t=e.split("/"),n={};n.user=t[0],n.list=t[1]||null,ext(options,n)}else e.constructor===Object&&ext(options,e)}var api,options;api={user:"http://api.twitter.com/1/statuses/user_timeline.json?include_entities=true&count={{count}}&include_rts={{retweets}}&exclude_replies={{!replies}}&screen_name={{user}}",list:"http://api.twitter.com/1/{{user}}/lists/{{list}}/statuses.json?include_entities=true",search:"http://search.twitter.com/search.json?include_entities=true&q={{search}}"},options={retweets:!0,replies:!1,user:"rogie",list:null,search:null,target:null,count:100,max:20,cacheExpire:12e4,success:function(){},error:function(){},templates:{base:'<div class="chirp">{{tweets}}</div>',tweet:'<p>{{html}}</p><span class="meta"><time><a href="http://twitter.com/{{user.screen_name}}/statuses/{{id_str}}">{{time_ago}}</a></time> \u2014 via <a href="http://twitter.com/{{user.screen_name}}" title="{{user.name}} \u2014 {{user.description}}">{{user.name}}</a></span>',justNow:"just now",oneMinuteAgo:"1 minute ago",minutesAgo:"{{time}} minutes ago",oneHourAgo:"1 hour ago",hoursAgo:"{{time}} hours ago",yesterday:"Yesterday",daysAgo:"{{time}} days ago",weeksAgo:"{{time}} weeks ago"}},this.show=function(e){init(e),options.target&&(document.getElementById(options.target).innerHTML=""),load()},this.constructor!==Chirp?(new Chirp(opts)).show():init(opts)};Chirp._script=document.scripts[document.scripts.length-1]